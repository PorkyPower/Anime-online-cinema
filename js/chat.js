function sendmsg(t=0){""==$("#msgtext").val()&&0==t||($.ajax({url:"http://"+window.location.host+"/api/sendmsg",method:"POST",dataType:"html",data:{token:infouser.token,textmsg:$("#msgtext").val(),attch:t}}),loadchat(),$("#msgtext").val(""))}function scrollchat(){const t=$("#chat-window");t.animate({scrollTop:1200},100)}$(document).on("click","#btn-close",function(){$("#chat-block-con").css("display","none"),$("#chat-block").attr("chat","")}),$(document).on("click","#openchat",function(){return"open"==$("#chat-block").attr("chat")?($("#chat-block").attr("chat",""),void $("#chat-block-con").css("display","none")):($("#chat-block-con").css("display","block"),void $("#chat-block").attr("chat","open"))}),$(document).on("click","#sticker-con",function(){sendmsg($(this).attr("idsticker"))}),$(document).on("click","#delchatbtn",function(){$.ajax({url:"http://"+window.location.host+"/api/delchatid",method:"post",dataType:"html",data:{token:infouser.token,idmsg:$(this).parents(".msg_text").attr("idmsg")}})}),$(document).on("click","#btn-msg",function(){sendmsg()}),$("#msgtext").on("keypress",function(t){13==t.which&&sendmsg()}),$(function(){null==infouser.id&&$("#chat-btns").html("");setInterval(()=>loadchat(),1e3);$("#chat-window").html(""),loadchat(1),scrollchat()});var stickers={};function get_sticker(t){for(var a="",s=0;s<stickers.length;s++)stickers[s].id==t&&(a=stickers[s].source);return a}function loadsticker(){let t=[{name:"",stickers:[]}];for(var a=0,s=0;s<stickers.length;s++)""!=t[a].name&&t[a].name!=stickers[s].name_pack?(a++,t[a]={name:stickers[s].name_pack,stickers:[]}):t[a].stickers.length<1&&(t[a]={name:stickers[s].name_pack,stickers:[]}),t[a].stickers.push({id:stickers[s].id,src:stickers[s].source});$("#stickers-cons").html(""),$("#typestickers").html("");for(s=0;s<t.length;s++){$("#typestickers").append("<div namepack="+t[s].name+" id=stickercat>"+t[s].name+"</div>");for(var i=0;i<t[s].stickers.length;i++)$("#stickers-cons").append("<div idsticker="+t[s].stickers[i].id+' id="sticker-con"><img id="img-sticker" src="http://'+window.location.host+t[s].stickers[i].src+'"></div>')}}var stickerload=0,delmsg='<div id=delmsgchat><div id=delchatbtn><svg width="16" height="16" viewBox="0 0 132 131" fill="none"xmlns="http://www.w3.org/2000/svg"><path d="M8.97217 122.833L66.014 65.7919M66.014 65.7919L123.055 8.74994M66.014 65.7919L8.97217 8.74994M66.014 65.7919L123.055 122.833" stroke="red" stroke-width="16.3206" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>',admchat="";function loadchat(i=0){""!=$("#chat-block").attr("chat")&&$.ajax({url:"http://"+window.location.host+"/api/loadchat"+infouser.token,method:"GET",dataType:"json",success:function(t){for(var a,s=t[0].data.length-1;-1<s;s--)0<$("div[idmsg="+t[0].data[s].id+"]").length?1==t[0].data[s].delmsg&&$("div[idmsg="+t[0].data[s].id+"]").html(""):(0==stickerload&&(stickers=t[1].data,loadsticker()),stickerload=1,0==t[0].data[s].delmsg&&($("#chat-window")[0].scrollHeight-700<$("#chat-window").scrollTop()&&0==i&&scrollchat(),infouser.id==t[0].data[s].userid?(a=new Date(1e3*+t[0].data[s].datemsg),$("#chat-window").append("<div idmsg="+t[0].data[s].id+" class=msg_text id=msg-from-me><div id=msg-from-me-con><div id=txt-msg><a href=/id"+t[0].data[s].userid+" target=_blank>"+t[0].data[s].login+"</a><div>"+("sticker"==t[0].data[s].attch?"<img id=img-sticker src=http://"+window.location.host+get_sticker(t[0].data[s].typeattch)+">":t[0].data[s].txtmsg)+"</div></div><span id=date-msg>"+a.getHours()+":"+a.getMinutes()+"</span></div>"+admchat+"</div>")):(a=new Date(1e3*+t[0].data[s].datemsg),$("#chat-window").append("<div idmsg="+t[0].data[s].id+" class=msg_text id=msg-from-users><div id=msg-from-users-con><div id=txt-msg><a href=/id"+t[0].data[s].userid+" target=_blank>"+t[0].data[s].login+"</a><div>"+("sticker"==t[0].data[s].attch?"<img id=img-sticker src=http://"+window.location.host+get_sticker(t[0].data[s].typeattch)+">":t[0].data[s].txtmsg)+"</div></div><span id=date-msg>"+a.getHours()+":"+a.getMinutes()+"</span></div>"+admchat+"</div>"))))}})}1==infouser.admin&&(admchat=delmsg);